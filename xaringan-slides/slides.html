<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>rtweet tutorial</title>
    <meta charset="utf-8" />
    <meta name="author" content="ðŸŒˆ Zane Dax (She/They) ðŸŒˆ" />
    <meta name="date" content="2022-01-08" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/rladies.css" rel="stylesheet" />
    <link href="libs/remark-css/rladies-fonts.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <script src="libs/jquery/jquery-3.6.0.min.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# rtweet tutorial
## <br/>with RLadies
### ðŸŒˆ Zane Dax (She/They) ðŸŒˆ
### 2022-01-08

---









class: inverse,center
background-image: url("slides_files/RLadies\ bg.png")
# rtweet

![rladies](slides_files/rtweet_R_logo 2.png)







---
class: inverse, center, middle

# Get Started

---





# rtweet library

Install the **rtweet** package from [Github](https://github.com/ropensci/rtweet):


```r
install.packages("rtweet")

library(knitr)
library(rtweet)
```

--

You are required to have a Twitter API access key in order to 
use the library.

- A user *must* authenticate their interaction with Twitter's API. If 
you already have an access token key, then a browser popup will 
appear where you need to click on permissions and verification.

--

- Once you have this set up you are ready to go

--

.footnote[
[1] my documentation is based on using a MacOS version 12.1

[2] See Twitter API documentation for full details and explanations
]



---
class: inverse, middle, center

# Data Mine the hashtags

---



# Hello Twitter Data

You will require a few more libraries to follow along with the slides:


```r
library(rtweet)
library(tidyverse)
library(ggplot2)
library(tidytext)
library(igraph)
library(ggraph)
library(showtext)
library(widyr)
library(tidyr)
library(DT)
```

- `ggplot` is for data visualization 
- `tidytext` is for text analysis
- `ggraph` is for graphing the word frequencies together
- `showtext` is to change the font style (not required but suggested)


---




# Find a #hashtag

You can see a trending hashtag on Twitter or use a word to get tweets on that specific hashtag. For this example we will use #DragRace. The rate limit is 
18,000 tweets per API call. We are not interested in retweets for this hashtag and 
set the function to false. Language settings are set to return English tweets only.

**search Twitter for all tweets with #DragRace**

```
DragRace_tweets = search_tweets2(
  "#DragRace",
  n= 18000,
  lang="en",
  include_rts=F
)
```

It is **strongly advised** you make use of variable names for your Twitter data as to avoid `rate limit` (getting timed-out or Twitter account suspended)

```
DragRace_tweets = write_as_csv(
  DragRace_tweets,
  file_name = "DragRace_tweets",
  prepend_ids = T,
  na="",
  fileEncoding = "UTF-8"
)
```


---
# read in saved data


```r
DragRace_tweets = read_twitter_csv(file ="../TwitterData/DragRace_tweets.csv" , unflatten = FALSE)
```





---
# #DragRace

**The Twitter API returns lots of meta-data information.**

this is `head(DragRace_tweets$text)`


[1] "So to watch #DragRace #DragRaceS14 in the UK Iâ€™ve got to pay for yet another streaming service?!     \n\nNope. Pity though, was looking forward to it. ðŸ˜’"
[2] "if ru says willowâ€™s name like that the whole season i think my entire skin will crawl off #DragRace"                                              
[3] "June and Orion are going to lip-sync foooooor theeeeeir liiiiiiiiiiives #DragRace"                                                                 
[4] "Watching season 14 premiere of #DragRace https://t.co/1iaHPzPj7L"     
[5] "Bosco... Thanks for that ending! #DragRace"                          
[6] "There's more depth to Willow Pill than her looks suggest, I like it #DragRace"  



There are 92 columns for the Twitter data


---
# just the text - 1

The Twitter data we have is messy and has url links, need to remove them.

```r
# ======== remove URLs
DragRace_tweets$stripped_text = gsub("http.*","", DragRace_tweets$text)
DragRace_tweets$stripped_text = gsub("https*","", DragRace_tweets$stripped_text)
```


```r
head(DragRace_tweets$stripped_text)
```

```
## [1] "So to watch #DragRace #DragRaceS14 in the UK Iâ€™ve got to pay for yet another streaming service?!     \n\nNope. Pity though, was looking forward to it. ðŸ˜’"
## [2] "if ru says willowâ€™s name like that the whole season i think my entire skin will crawl off #DragRace"                                                      
## [3] "June and Orion are going to lip-sync foooooor theeeeeir liiiiiiiiiiives #DragRace"                                                                        
## [4] "Watching season 14 premiere of #DragRace "                                                                                                                
## [5] "Bosco... Thanks for that ending! #DragRace"                                                                                                               
## [6] "There's more depth to Willow Pill than her looks suggest, I like it #DragRace"
```

---
# just the text - 2

This code **tokenizes** the words to allow for easy word counts and further text analysis. 


```r
# ===== tidytext::unnest_tokens()
clean_DragRace_tweets = DragRace_tweets %&gt;% 
  select(stripped_text) %&gt;% 
  unnest_tokens(word, stripped_text) # tokens
```

---


```r
# head(clean_DragRace_tweets, 10)
datatable(head(clean_DragRace_tweets, 10), editable = 'cell')
```

<div id="htmlwidget-459fe99be336c3f2e10d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-459fe99be336c3f2e10d">{"x":{"filter":"none","vertical":false,"editable":{"target":"cell","disable":{"columns":null},"numeric":[],"area":[]},"data":[["1","2","3","4","5","6","7","8","9","10"],["so","to","watch","dragrace","dragraces14","in","the","uk","iâ€™ve","got"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>word<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>




---
# Tweet Word Counts - 1

Top 10 words, counted and sorted 


```r
# == plot, word counts of clean text  (stopwords included)
clean_DragRace_tweets %&gt;% 
  count(word, sort= T) %&gt;% 
  top_n(10) %&gt;% 
  mutate(word= reorder(word, n))
```

```
## Selecting by n
```

```
## # A tibble: 10 Ã— 2
##    word         n
##    &lt;fct&gt;    &lt;int&gt;
##  1 dragrace 12798
##  2 the       5391
##  3 i         3544
##  4 is        2994
##  5 to        2589
##  6 a         2573
##  7 and       2397
##  8 of        2222
##  9 this      1869
## 10 for       1737
```

```r
head(clean_DragRace_tweets)
```

```
## # A tibble: 6 Ã— 1
##   word       
##   &lt;chr&gt;      
## 1 so         
## 2 to         
## 3 watch      
## 4 dragrace   
## 5 dragraces14
## 6 in
```


---




--- 
# Tweet Word Counts - 1.1

`stopwords` are included in this plot

![](slides_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;


---
# Tweet Word Counts - 1.2

`stopwords` are removed from the data 

```r
# ========== tidytext stop_words + anti_join
clean_DragRace_words = clean_DragRace_tweets %&gt;% 
  anti_join(stop_words)

clean_DragRace_words %&gt;% 
  count(word, sort= T) %&gt;% 
  top_n(10) %&gt;%
  filter(word &gt; 10)
```

```
## # A tibble: 10 Ã— 2
##    word                n
##    &lt;chr&gt;           &lt;int&gt;
##  1 dragrace        12798
##  2 season           1497
##  3 willow           1386
##  4 kornbread        1327
##  5 rupaulsdragrace   931
##  6 kerri             834
##  7 love              798
##  8 drag              753
##  9 iâ€™m               741
## 10 14                595
```


---
# Tweet Word Counts - 1.3
![](slides_files/figure-html/unnamed-chunk-12-1.png)&lt;!-- --&gt;




---

# bigram and n-grams


```r
# ============= NETWORK OF WORDS !
library(widyr)

# bigrams. n-grams
DragRace_tweets_paired_words = DragRace_tweets %&gt;% 
  select(stripped_text) %&gt;% 
  unnest_tokens(paired_words, 
                stripped_text, 
                token="ngrams",
                n= 2)

DragRace_tweets_paired_words %&gt;% 
  count(paired_words, sort = T) %&gt;% 
  top_n(5)
```

```
## # A tibble: 6 Ã— 2
##   paired_words     n
##   &lt;chr&gt;        &lt;int&gt;
## 1 season 14      541
## 2 willow pill    514
## 3 i love         411
## 4 in the         408
## 5 drag race      393
## 6 of the         393
```





---

# word pair splitting

we now split the bigrams into n-gram

```r
# ======== word pair splitting
library(tidyr)

DragRace_tweets_word_splits = DragRace_tweets_paired_words %&gt;% 
  separate(paired_words, c('word1','word2'), sep = " ")

DragRace_tweets_filtered &lt;- DragRace_tweets_word_splits %&gt;%
  filter(!word1 %in% stop_words$word) %&gt;%
  filter(!word2 %in% stop_words$word)

# new bigram counts:
DragRace_tweets_words_counts &lt;- DragRace_tweets_filtered %&gt;%
  count(word1, word2, sort = TRUE)

head(DragRace_tweets_words_counts)
```

```
## # A tibble: 6 Ã— 3
##   word1           word2               n
##   &lt;chr&gt;           &lt;chr&gt;           &lt;int&gt;
## 1 season          14                541
## 2 willow          pill              514
## 3 drag            race              393
## 4 dragrace        rupaulsdragrace   276
## 5 kerri           colby             270
## 6 rupaulsdragrace dragrace          209
```


---

# Graph the words

Now that we have the n-grams and counted, we can graph them to see what words are associated together.


graph of word network
```
DragRace_tweets_words_counts %&gt;% 
  filter(n &gt;= 10) %&gt;% 
  ggraph(layout = "fr")
```

---
![](slides_files/figure-html/unnamed-chunk-15-1.png)&lt;!-- --&gt;

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
