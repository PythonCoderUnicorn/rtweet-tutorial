---
title: "rtweet tutorial"
subtitle: "<br/>with RLadies"
author: "ðŸŒˆ Zane Dax (She/They) ðŸŒˆ"
institute: ""
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: [default, rladies, rladies-fonts]
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE)
options(htmltools.dir.version = FALSE)
```




class: inverse,center
background-image: url("slides_files/RLadies\ bg.png")
# rtweet

![rladies](slides_files/rtweet_R_logo 2.png)







---
class: inverse, center, middle

# Get Started

---





# rtweet library

Install the **rtweet** package from [Github](https://github.com/ropensci/rtweet):

```{r eval=FALSE, tidy=FALSE, message=FALSE, warning=FALSE}
install.packages("rtweet")

library(knitr)
library(rtweet)
```

--

You are required to have a Twitter API access key in order to 
use the library.

- A user *must* authenticate their interaction with Twitter's API. If 
you already have an access token key, then a browser popup will 
appear where you need to click on permissions and verification.

--

- Once you have this set up you are ready to go

--

.footnote[
[1] my documentation is based on using a MacOS version 12.1

[2] See Twitter API documentation for full details and explanations
]



---
class: inverse, middle, center

# Data Mine the hashtags

---



# Hello Twitter Data

You will require a few more libraries to follow along with the slides:

```{r message=FALSE, warning=FALSE}
library(rtweet)
library(tidyverse)
library(ggplot2)
library(tidytext)
library(igraph)
library(ggraph)
library(showtext)
library(widyr)
library(tidyr)
library(DT)
```

- `ggplot` is for data visualization 
- `tidytext` is for text analysis
- `ggraph` is for graphing the word frequencies together
- `showtext` is to change the font style (not required but suggested)


---




# Find a #hashtag

You can see a trending hashtag on Twitter or use a word to get tweets on that specific hashtag. For this example we will use #DragRace. The rate limit is 
18,000 tweets per API call. We are not interested in retweets for this hashtag and 
set the function to false. Language settings are set to return English tweets only.

**search Twitter for all tweets with #DragRace**

```
DragRace_tweets = search_tweets2(
  "#DragRace",
  n= 18000,
  lang="en",
  include_rts=F
)
```

It is **strongly advised** you make use of variable names for your Twitter data as to avoid `rate limit` (getting timed-out or Twitter account suspended)

```
DragRace_tweets = write_as_csv(
  DragRace_tweets,
  file_name = "DragRace_tweets",
  prepend_ids = T,
  na="",
  fileEncoding = "UTF-8"
)
```


---
# read in saved data

```{r}
DragRace_tweets = read_twitter_csv(file ="../TwitterData/DragRace_tweets.csv" , unflatten = FALSE)
```





---
# #DragRace

**The Twitter API returns lots of meta-data information.**

this is `head(DragRace_tweets$text)`
```{r echo=FALSE}
# head(DragRace_tweets$text)
# df = head(DragRace_tweets,10)
# 
# df %>%
#   DT::datatable(fillContainer = F, options = list(pageLength=3)) %>%
#   DT::formatStyle(0, target = "row", lineHeight='20%')
```

[1] "So to watch #DragRace #DragRaceS14 in the UK Iâ€™ve got to pay for yet another streaming service?!     \n\nNope. Pity though, was looking forward to it. ðŸ˜’"
[2] "if ru says willowâ€™s name like that the whole season i think my entire skin will crawl off #DragRace"                                              
[3] "June and Orion are going to lip-sync foooooor theeeeeir liiiiiiiiiiives #DragRace"                                                                 
[4] "Watching season 14 premiere of #DragRace https://t.co/1iaHPzPj7L"     
[5] "Bosco... Thanks for that ending! #DragRace"                          
[6] "There's more depth to Willow Pill than her looks suggest, I like it #DragRace"  



There are 92 columns for the Twitter data


---
# just the text - 1

The Twitter data we have is messy and has url links, need to remove them.
```{r}
# ======== remove URLs
DragRace_tweets$stripped_text = gsub("http.*","", DragRace_tweets$text)
DragRace_tweets$stripped_text = gsub("https*","", DragRace_tweets$stripped_text)
```

```{r}
head(DragRace_tweets$stripped_text)

```

---
# just the text - 2

This code **tokenizes** the words to allow for easy word counts and further text analysis. 

```{r}
# ===== tidytext::unnest_tokens()
clean_DragRace_tweets = DragRace_tweets %>% 
  select(stripped_text) %>% 
  unnest_tokens(word, stripped_text) # tokens
```

---

```{r}
# head(clean_DragRace_tweets, 10)
datatable(head(clean_DragRace_tweets, 10), editable = 'cell')
```




---
# Tweet Word Counts - 1

Top 10 words, counted and sorted 

```{r}
# == plot, word counts of clean text  (stopwords included)
clean_DragRace_tweets %>% 
  count(word, sort= T) %>% 
  top_n(10) %>% 
  mutate(word= reorder(word, n))

head(clean_DragRace_tweets)

```


---




--- 
# Tweet Word Counts - 1.1

`stopwords` are included in this plot

```{r echo=FALSE, fig.width=10, message=FALSE, warning=FALSE}
clean_DragRace_tweets %>% 
  count(word, sort= T) %>% 
  top_n(20) %>% 
  mutate(word= reorder(word, n)) %>% 
  ggplot( aes(x= word, y= n))+
  geom_col(fill= "#d534eb")+
  ggdark::dark_mode()+
  coord_flip()+
  labs(title = "Twitter tweet word counts for #DragRace",
       x="unique words",
       y= "Count")+
  theme(text = element_text(family = 'Poppins', size = 12))

```


---
# Tweet Word Counts - 1.2

`stopwords` are removed from the data 
```{r warning=FALSE, message=FALSE}
# ========== tidytext stop_words + anti_join
clean_DragRace_words = clean_DragRace_tweets %>% 
  anti_join(stop_words)

clean_DragRace_words %>% 
  count(word, sort= T) %>% 
  top_n(10) %>%
  filter(word > 10)
```


---
# Tweet Word Counts - 1.3
```{r echo=FALSE, fig.width=10, message=FALSE, warning=FALSE}
clean_DragRace_words %>% 
  count(word, sort= T) %>% 
  top_n(40) %>%
  filter(word > 10) %>% 
  # filter(!word == c('s4','2',"i' \tm",'phi','e1','s4','2','e1','el','s2',"i'm")) %>%
  mutate(word = as_factor(word),
    word= reorder(word, n)) %>% 
  ggplot( aes(x= word, y= n))+
  geom_col(fill= "#d534eb")+
  ggdark::dark_mode()+
  coord_flip()+
  labs(title = "Twitter tweet word counts for #DragRace",
       subtitle = "top 40 words. Retweets excluded. N = 824",
       x="unique words",
       y= "Count",
       caption = "@StarTrek_Lt | Jan 3, 2022 | Source: Twitter API & {rtweet} package")+ 
  theme(
   text =  element_text(family = 'Poppins'),
   plot.title = element_text(size = 15, 
                             face = 'bold',
                             color ="#e757fa" ),
    axis.title = element_text(size = 13),
    axis.text = element_text(size = 12),
   plot.caption = element_text(color = 'grey40', hjust = 0)
   )
```




---

# bigram and n-grams

```{r warning=FALSE, message=FALSE}
# ============= NETWORK OF WORDS !
library(widyr)

# bigrams. n-grams
DragRace_tweets_paired_words = DragRace_tweets %>% 
  select(stripped_text) %>% 
  unnest_tokens(paired_words, 
                stripped_text, 
                token="ngrams",
                n= 2)

DragRace_tweets_paired_words %>% 
  count(paired_words, sort = T) %>% 
  top_n(5)
```





---

# word pair splitting

we now split the bigrams into n-gram
```{r warning=FALSE, message=FALSE}
# ======== word pair splitting
library(tidyr)

DragRace_tweets_word_splits = DragRace_tweets_paired_words %>% 
  separate(paired_words, c('word1','word2'), sep = " ")

DragRace_tweets_filtered <- DragRace_tweets_word_splits %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word)

# new bigram counts:
DragRace_tweets_words_counts <- DragRace_tweets_filtered %>%
  count(word1, word2, sort = TRUE)

head(DragRace_tweets_words_counts)
```


---

# Graph the words

Now that we have the n-grams and counted, we can graph them to see what words are associated together.


graph of word network
```
DragRace_tweets_words_counts %>% 
  filter(n >= 10) %>% 
  ggraph(layout = "fr")
```

---
```{r echo=FALSE, fig.width=12, fig.height=10}
DragRace_tweets_words_counts %>% 
  # words > 24
  filter(n >= 10) %>% 
  # graph_from_data_frame() %>% 
  ggraph(layout = "fr")+
  ggdark::dark_mode()+
  geom_node_point(color="#e757fa", size=3)+
  geom_node_text( aes(label= name), vjust= 1.8, size= 4)+
  labs(title = "Twitter word network for #DragRace",
       subtitle = "Text Mining:  N= 13000 tweets, word counts >= 10",
       x="",
       y="",
       caption="@StarTrek_Lt | Jan 8, 2022 | Source: Twitter API | Sample Size: N= 3285 split words")+
  theme(text = element_text(family = 'Poppins'),
        plot.title = element_text(color = '#e757fa', size = 14),
        plot.caption = element_text(color = 'grey60', hjust = 0, size = 10)
        )
```

